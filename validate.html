<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./css/global.css" />
    <link rel="stylesheet" href="./css/validate.css" />
    <title>VALIDAÇÃO E AUTENTICAÇÃO</title>
  </head>
  <body>
    <div id="container">
      <img id="logo" src="./images/logo.png" alt="logo empresa" />
      <img id="loading" src="./images/loading.gif" alt="Loading" />
      <h2>Seja Bem-vindo!!!</h2>
    </div>

    <script>
      const pegarParametroUrl = (nome) => {
        nome = nome.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        const regex = new RegExp("[\\?&]" + nome + "=([^&#]*)");
        const resultados = regex.exec(location.search);
        return resultados === null
          ? ""
          : decodeURIComponent(resultados[1].replace(/\+/g, " "));
      };

      const telefoneUrl = pegarParametroUrl("tel");
      const mesaUrl = pegarParametroUrl("mesa");
      let urlRequisicao = "controller/validate.php";

      if (telefoneUrl) {
        urlRequisicao += "?tel=" + encodeURIComponent(telefoneUrl);
      } else if (mesaUrl) {
        urlRequisicao += "?mesa=" + encodeURIComponent(mesaUrl);
      }

      fetch(urlRequisicao)
        .then((resposta) => resposta.json())
        .then((dados) => {
          if (dados.status === "ok") {
            setTimeout(() => {
              window.location.href = "index.html";
            }, 3200);
          } else {
            setTimeout(() => {
              window.location.href = "https://agapesi.ddns.com.br/";
            }, 3200);
          }
        })
        .catch((erro) => {
          console.error("Erro na requisição:", erro);
          window.location.href = "erro.html";
        });
    </script>
  </body>
</html>
